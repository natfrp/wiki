# 其他游戏联机说明

本页由下面两部分组成：

- [一些游戏说明碎片](#tips)
- [通用策略](#general)

通常来说，您应该先查看 [一些游戏说明碎片](#tips) 部分并查找其中是否有您需要的游戏的说明，  
如果没有，查看 [通用策略](#general) 部分以获取一些尝试的思路。

## 一些游戏说明碎片 {#tips}

此处收录一些我们暂时没有充足时间精力扩展为完整教程的联机说明或 Tips，希望能给您提供一些帮助。

如果存在问题或者您希望补充，欢迎提交 PR。

### 起源引擎游戏

我们有一个由社区贡献的 [起源引擎游戏服务器穿透指南](/offtopic/source) 供您参考。

### 幸福工厂 (Satisfactory) {#satisfactory}

幸福工厂独立服务器在同一端口数字上使用 TCP/UDP，因此：

  1. 依据 [双栈端口](#tcp-udp) 中的策略**创建两个隧道**
  1. 编辑游戏服务器启动参数，加入或更改 `-Port=上面的端口`
  1. 保证两个隧道都打开

在 1.1 更新后，幸福工厂现在需要第三个隧道，因此您将需要：（仅当您游玩 1.1 及以上版本时需要）

  1. 创建一个 **TCP** 隧道，本地端口选择 `8888`，远程端口留空以随机生成即可
  1. 继续编辑游戏服务器启动参数，加入或更改 `-ExternalReliablePort=新隧道的远程端口`
  1. 保证三个隧道都打开

综上所述，如果您在游玩 1.1+ 版本，需要在独立服务器启动选项中加入的内容是：

`-Port=隧道1和2（数字完全相同的两个隧道）的端口 -ExternalReliablePort=第三个隧道（本地端口写着8888的）的远程端口`

此后通过在游戏主界面中点击 服务器管理 - 添加服务器 即可连接到并设置您的服务器。

如果您不知道填入什么内容：找到日志中的地址（形如`使用 >>frp-xxx.com:11221<< 来连接到您的隧道`），  
将其中冒号前的部分（形如 `frp-xxx.com`）填入服务器地址（称为 *域名*），冒号后的部分为端口。

### 夜族崛起 (V Rising) {#v-rasing}

夜族崛起使用 **UDP** 协议，所以我们需要配置一个 UDP 隧道：

1. 创建一个 **UDP** 隧道，本地端口选择 **和远程一致**，远程端口留空以随机生成即可；创建完成后，记录端口，端口号可以在下图红色框框内的位置找到，**请使用自己的端口号**
  ![](./_images/v-rasing-create-tunnel.png)
1. 在游戏目录的找到 `VRising-Server` 目录，进入后寻找启动脚本：如果你是 Windows 系统，寻找 `.bat` 结尾的文件，如果是 Linux，则寻找 `.sh` 结尾的文件
1. **复制** 你找到的启动脚本，**重命名复制的文件** 为 `start-my-server.bat`（linux 则重命名为 `start-my-server.sh`）
1. 编辑刚刚复制且重命名的脚本（点击鼠标 **右键**，单击编辑选项），观察文件内容中是否包含 `-gamePort` 字符
   - 如果有，请将 `-gamePort` 后面的数字，改为第一步中的端口号
   - 如果没有，请在执行程序的行末尾 **打一个空格**，然后添加 `-gamePort 上面的端口`（注意前面要有空格，空格可多不可少）
1. 例如：假设上面的端口为 `28888`，则文件内容应修改为：

  ```bat
  ...#此处省略一堆内容
  VRisingServer.exe ...#此处省略一堆内容 -gamePort 28888 
    ^-- 执行服务端，修改此行               ^-- 新增加或修改的参数
  ```

### 僵尸毁灭工程 (Project Zomboid) {#projz}

僵尸毁灭工程的开发人员的大脑分外聪慧，因此我们需要两个 UDP 隧道：

  1. 创建一个 UDP 隧道，记为隧道 A（请设定一个明确的隧道名防止搞混），本地端口选择 `和远程一致`，远程端口留空以随机生成
  1. **在同一个节点** 再创建一个 UDP 隧道，记为隧道 B，本地端口继续选择 `和远程一致`，远程端口继续留空以随机生成
  1. 记下两个隧道的远程端口，下面我们以 端口 A 和 端口 B 代表
  
打开您的服务端配置文件：`%USERPROFILE%\Zomboid\Server\servertest.ini` 或者说叫 `C:\Users\你的用户名\Zomboid\Server\servertest.ini`，  
在这里我们需要修改两行：

- 找到 `DefaultPort=`， 后面通常是 `16261`，修改为端口 A
- 找到 `UDPPort=`， 后面通常是 `16262`，修改为端口 B

在联机时请保证两个隧道都已开启，游戏内服务器端口输入端口 A。

### 饥荒联机版 (Don't Starve Together) {#dst}

已迁移到 [独立页面](/app/dst.html)。

### 七日杀 (7 Days to Die) {#7dtd}

七日杀在同一端口上使用 TCP **和** UDP，因此您需要：

  1. 开始创建一个 UDP 隧道，本地端口选择 `26900`，远程端口留空以随机生成即可  
    （本地端口通常应该设置为 `26900`，如您自行设置了服务端端口，则设置为您自己的）
  1. 在点击创建按钮前，点击创建按钮左边的 `批量创建选项`，选中 `创建同端口 TCP 隧道`，然后点击创建按钮
  1. 保证批量创建的两个隧道都打开

我们注意到，某些情况下、七日杀联机中可能存在需要使用两个额外隧道的情况（共计需四个，请确认自己的隧道配额足够），如您遇到反复排查联机仍无法正常连接的情况，请参考下面的方法操作：

  1. 开始创建一个 **UDP** 隧道，本地端口选择 `26900`，远程端口留空以随机生成  
     （本地端口通常应该设置为 `26900`，如您自行设置了服务端端口，则设置为您自己的）
  1. 在点击创建按钮前，点击创建按钮左边的 `批量创建选项`，选中：  
    `创建同端口 TCP 隧道` 、  
    `创建 远程端口+1 UDP 隧道`（有时不需要，如需节省隧道可以尝试删除此隧道）、  
    `创建 远程端口+2 UDP 隧道`，  
    然后点击创建按钮  
    （最终结果应当看到四个隧道：_TCP、_UDP、_UDP_1、_UDP_2）
  1. 保证四个隧道都打开

### 灵魂面甲 (Soulmask) {#soulmask}

灵魂面甲使用 **UDP** 协议，因此我们需要配置一个 UDP 隧道：

  1. 创建一个 **UDP** 隧道，本地端口输入并选择 8777，远程端口留空以随机生成即可
  1. 启动灵魂面甲独立服务器，启动隧道
  1. 找到日志中的地址（形如`使用 >>frp-xxx.com:11221<< 来连接到您的隧道`），点击在箭头中间的部分复制连接地址，  
     其中冒号前的部分（形如 `frp-xxx.com`）为服务器 IP（称为 *域名*，此处使用时与 IP 等价），冒号后的部分为端口。
  1. 在游戏中点击 `直接连接到服务器` 并输入上面的信息来连接到您的隧道即可。

### 人渣 (SCUM) {#scum}

::: warning 运行警告
SCUM 服务端对电脑配置要求较高，请确认您的电脑有至少 10GB 的可用内存 **只** 用于运行服务端，  
如果您的内存不足，服务端仍会正常尝试启动并在数分钟后崩溃（表现为窗口突然消失），全程无法正常连接。
:::

人渣（游戏名）的设计较为神奇，请跟随配置隧道：

  1. 开始创建一个 **UDP** 隧道，本地端口选择 `和远程一致`，远程端口留空以随机生成
  1. 在点击创建按钮前，点击创建按钮左边的 `批量创建选项`，选中 `创建远程端口+2 TCP 隧道`，然后点击创建按钮
  1. 记下 UDP 隧道的远程端口备用，下面我们以 *U端口* 代称
  1. 编辑游戏服务器启动参数，加入或更改 `-port=U端口`  
    \*: 这一步通常的操作为 右键 `SCUM Server` - `属性` - `通用` - `启动选项`，然后添加或修改上述参数  
    \*: 对于使用 bat 文件的，请在指令末尾添加、或修改参数等号后面的值（如果参数已存在）
  1. 启动游戏服务器，并确保 **两个隧道都打开**
  1. 打开日志，点击日志界面顶端的下拉框（筛选），选中项目 `Tunnel/[您设置的隧道名]_1`（即 TCP 隧道） 以筛选我们需要的隧道信息
  1. 找到日志中连接提示（形如`使用 >>frp-xxx.com:11221<< 来连接到您的隧道`），点击在箭头中间的部分复制 **连接地址**  
    \*: 其中冒号前的部分（形如 `frp-xxx.com`）为服务器地址（称为 *域名*，使用时与 IP 等价），冒号后的部分为端口。
  1. 重新选中日志筛选框为顶部的空白项以查看全部日志

游戏加入：

  1. 请务必确认您复制的连接地址中的端口部分应当是两个隧道的端口中 **大** 的那一个（即 TCP 隧道的端口）
  1. 在 *多人游戏* - 地址框 中粘贴这个连接地址，点击连接或回车连接即可

### 异星旅人 (ASTRONEER) {#astroneer}

异星旅人游戏的设计可能是本文档中最为大脑升级的一个，其特色是：  
服务器是否在线似乎并不取决于玩家能否连接到服务器，而是这个 IP 有没有被配置到服务端程序中并发送到官方服务器。

因此 **请总是选择多线节点或特定运营商节点**（名字中带 `多线`，或 `电信/移动/联通`）， **不要** 选择三线节点（名字中带 `三线/双线`）。

对于 Steam 用户来说，此游戏的独立服务端与其他游戏类似，在购买游戏后即会出现在 “工具” 中，下载并启动一次以生成初始配置即可。  
配置目录位于 Steam 界面的 右键 `ASTRONEER Dedicated Server` - `管理` - `浏览本地文件`，在打开的目录中依次进入 `Astro\Saved\Config\WindowsServer`。

接下来开始配置：

  1. 在您选择的节点上开始创建一个 **UDP** 隧道，本地端口选择 `和远程一致`，远程端口留空以随机生成。
  1. 记下此隧道的端口，打开配置目录中的 `Engine.ini`，在 **底部另起一行** 加入下面内容，**并保存**：  

      ```ini
          [URL]
          Port=上面隧道的端口
      ```

  1. **启动隧道**，打开日志页，找到日志中的连接地址（形如 `或使用节点 IP 连接 (不推荐) >>x.x.x.x:yyyyy<<`），点击在箭头中间的部分复制 **连接地址**  
    \*: 其中冒号前的部分（形如 `1.2.3.4`）为 IP，冒号后的数字部分为端口，请确认复制了正确的项目，形状为四个数字中间带点，没有字母。
  1. 打开配置目录中的 `AstroServerSettings.ini`，编辑您希望编辑的项目，并修改 `PublicIP=` 后面为上面复制到的 **IP 部分**，**并保存**  
    \*: 只有 IP 部分，也就是形状是四个数字中间带点的玩意，冒号和冒号后面的数字不要。
  1. **启动服务器**（`ASTRONEER Dedicated Server`），启动后如果一分钟内 Steam 按钮没有变回 `启动游戏`，就说明启动成功了（您也可以使用第三方工具管理来规避这个反人类设计）。

在连接时：

  1. 进入游戏，进入服务器功能（最后一个图标），点击 `添加专用服务器`。
  1. 请使用前面复制的 **连接地址** 粘贴入 `服务端地址` 项目，并随喜好设置 `服务端昵称`。
  1. 现在您应当可以看到服务端正常在线，显示在线人数 `0/8` 了，点击加入即可。

服务器是否可连接，似乎与服务器是否真的可连接 **无关**，只与您是否 **配置了正确地址** 并 **启动了服务端程序** 有关。  
因此下次启动时，启动隧道和启动服务端的顺序应当是可以互换的。

## 通用策略 {#general}

如果文档内容没有覆盖您需要的游戏的话，您可以参考我们为您准备的通用策略自行尝试。

对于大量游戏来说，官方提供用于联机的独立服务器程序 (Dedicated Server) ，  
您需要搜索、下载并运行它，游戏服务器通常会有一个或多个端口，这些端口也就是我们穿透的对象。

如果您尚不清楚您所使用游戏服务器的端口，您可以通过搜索引擎获取相关信息，或使用启动器点击创建隧道，并点击本地端口右侧的 `选择本地进程` 按钮看到所有进程及端口，在其中搜索即可。

在您确定服务器端口后，一个常规的决策思路通常如下（项目可点击跳转）：

```flow
st=>start: 开始判断
cond1=>operation: 服务器只有一个 TCP 端口?|approved:>#single-tcp
cond2=>operation: 服务器只有一个 UDP 端口?|approved:>#single-udp
cond3=>operation: 服务器有一个 TCP 端口和一个 UDP 端口?|approved:>#tcp-udp
unknown=>operation: 都不是|invalid:>#other

st(right)->cond1
cond1(bottom)->cond2
cond2(bottom)->cond3
cond3(right)->unknown
```

### 单 TCP {#single-tcp}

如果游戏只有一个 TCP 端口，您可以创建一个 TCP 隧道，本地端口指定为相应端口，远程端口留空以随机生成。

### 单 UDP {#single-udp}

如果游戏只有一个 UDP 端口，您可以创建一个 UDP 隧道。

如果您知道如何修改游戏服务器的启动参数，您可以尝试修改以将游戏端口指定为您创建的隧道的端口的话，  
为了更好的兼容性，我们建议您使用 `和远程一致` 的本地端口，远程端口留空以随机生成即可。  
然后将游戏端口修改为上面隧道生成的端口。

如果您不知道如何修改，您可以尝试创建一个 UDP 隧道，本地端口指定为相应端口，远程端口留空以随机生成。  
我们无法保证此时游戏一定可以工作。

### 双栈端口 {#tcp-udp}

这种情况下我们需要分类讨论，对于有的游戏可能实际上只有一个端口负责承载游戏流量，因此您应当或可以考虑先依次尝试：

- [尝试单 TCP 配置并测试能否正常使用](#single-tcp)
- [尝试单 UDP 配置并测试能否正常使用](#single-udp)

如果测试可行的话，您可以如此使用，并省一条隧道。

如果不可行的话，请查看 TCP 和 UDP 两个端口的数字是否相同：

:::tabs

@tab 相同

游戏可能要求同一端口的 TCP/UDP 连接同时可用，所以我们需要配置两条隧道：

  1. 准备创建一个 TCP 隧道，本地端口选择 `和远程一致`，远程端口留空以随机生成即可
  1. 在点击创建按钮前，点击创建按钮左边的 `批量创建选项`，选中 `创建同端口 UDP 隧道`，然后点击创建按钮
  1. 配置服务端将游戏的端口 (`port`) 修改为您创建隧道的端口
  1. 在联机时，您应当保证两个隧道都打开

@tab 不同

请参考 [其他情况](#other)

:::

### 其他情况 {#other}

我们也不知道，您可能需要交叉手指并进行猜谜。或查询游戏官方文档，找到真正承载游戏数据的端口。
